{% extends 'base.html' %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<link rel="stylesheet" href="{% static 'css/csy.css' %}">
<style type="text/css">
 
</style>
{% if user.is_authenticated %} 
    <h3 class="menuTitle">Yearly by Month: <B>{{prdname.0}}</B></h3>
    <form method="GET">
        <div class="searchForm">
            <input type="number" id="yearSearch" name="input-year" min="2000" max="2099" step="1" class="select"/>
            <select name="input-prd" id="selectSearch" class="select" onChange="selectedPrd()">
                <option value="11530035" selected>æ´»è”˜28D</option>
                <option value="11060162">è”˜ç²¾ETç§˜</option>
                <option value="17010087">æ´»è”˜28D/è”˜æ´»åŠ›é£²ç¦®ç›’</option>
                <option value="17010088">è”˜çŸ³æ¦´é£²</option>
                <option value="17010004">è”˜é‡æ«»è“é£²</option>
                <option value="17010002">è”˜ç²¾ETç¦®ç›’</option>
            </select>
            <input type="submit" id="btnSearch" value="ğŸ”ï¸">
            <input type="button" class="btnExcel" value="ğŸ“¥Excel">
        </div>
        <p id="pCount">æ•¸æ“šæ•¸ : {{data.count}} æ¢</p>
        <p id="pInfo"><B>* æœˆå¹³å‡</B>= éŠ·è²¨é‡/12, <B>åº«å­˜æœˆä»½</B>= åº«å­˜é‡/æœˆå¹³å‡</p>
        <div class="dataGrid">
            <table class="tableGrid" id="myTable">
                <thead class="sticky-element">
                    <tr>
                        <th rowspan="2"><B>é–€å¸‚ä»£è™Ÿ</B></th>
                        <th rowspan="2"><B>ç¸£å¸‚</B></th>
                        <th rowspan="2"><B>é–€å¸‚åç¨±</B></th>
                        <th rowspan="2"><B>ä¸Šå­˜é‡</B></th>
                        <th rowspan="2"><B>é€²è²¨é‡</B></th>
                        <th rowspan="2"><B>é€€è²¨é‡</B></th>
                        <th colspan="12"><B>éŠ·è²¨é‡</B></th>
                        <th rowspan="2"><B>éŠ·å”®åŠ ç¸½</B></th>
                        <th rowspan="2"><B>åº«å­˜é‡</B></th>
                        <th rowspan="2"><B>æœˆå¹³å‡</B></th>
                        <th rowspan="2"><B>åº«å­˜æœˆä»½</B></th>
                    </tr>
                    <tr>
                        <th><B>1æœˆ</B></th>
                        <th><B>2æœˆ</B></th>
                        <th><B>3æœˆ</B></th>
                        <th><B>4æœˆ</B></th>
                        <th><B>5æœˆ</B></th>
                        <th><B>6æœˆ</B></th>
                        <th><B>7æœˆ</B></th>
                        <th><B>8æœˆ</B></th>
                        <th><B>9æœˆ</B></th>
                        <th><B>10æœˆ</B></th>
                        <th><B>11æœˆ</B></th>
                        <th><B>12æœˆ</B></th>
                    </tr>
                </thead>
                <tbody id="datafield">
                    {% if data %}
                    {% comment %} {% for data in data %}
                    <tr>
                        <td id="strcode">{{data.str_code}}</td>
                        <td id="strcity">{{data.str_code__str_city}}</td>
                        <td id="strname">{{data.str_code__str_name}}</td>
                        <td id="strsumsave">{{data.inv_d_save__sum}}</td>
                        <td id="strsumbuy">{{data.inv_d_buy__sum}}</td>
                        <td id="strsumreturn">{{data.inv_d_return__sum}}</td>

                        <td id="saleMonField1"> </td>
                        <td id="saleMonField2"> </td>
                        <td id="saleMonField3"> </td>
                        <td id="saleMonField4"> </td>
                        <td id="saleMonField5"> </td>
                        <td id="saleMonField6"> </td>
                        <td id="saleMonField7"> </td>
                        <td id="saleMonField8"> </td>
                        <td id="saleMonField9"> </td>
                        <td id="saleMonField10"></td>
                        <td id="saleMonField11"></td>
                        <td id="saleMonField12"></td>
                        
                        <td id="strsumsale">{{data.inv_d_sale__sum}}</td>
                        <td id="strsumstock">{{data.inv_d_stock__sum}}</td>
                        <td id="strmonavg">{% widthratio data.inv_d_sale__sum 12 1 %}</td>
                        <input type="hidden" value="{% widthratio data.inv_d_sale__sum 12 1 as monAvg %}">
                        <td id="strmonstock">{% widthratio data.inv_d_stock__sum monAvg 1 %}</td>
                    </tr>
                    {% endfor %} {% endcomment %}
                    <tr>
                        <td colspan="3"><B>Total</B></td>
                        <td><B>{{totaldata.inv_d_save__sum}}</B></td>
                        <td><B>{{totaldata.inv_d_buy__sum}}</B></td>
                        <td><B>{{totaldata.inv_d_return__sum}}</B></td>

                        {% for totalsale in totalsale %}
                        <td>{% if totalsale.inv_d_date__month == 1 %}{{totalsale.inv_d_sale__sum}}{% endif %}</td>
                        <td>{% if totalsale.inv_d_date__month == 2 %}{{totalsale.inv_d_sale__sum}}{% endif %}</td>
                        <td>{% if totalsale.inv_d_date__month == 3 %}{{totalsale.inv_d_sale__sum}}{% endif %}</td>
                        <td>{% if totalsale.inv_d_date__month == 4 %}{{totalsale.inv_d_sale__sum}}{% endif %}</td>
                        <td>{% if totalsale.inv_d_date__month == 5 %}{{totalsale.inv_d_sale__sum}}{% endif %}</td>
                        <td>{% if totalsale.inv_d_date__month == 6 %}{{totalsale.inv_d_sale__sum}}{% endif %}</td>
                        <td>{% if totalsale.inv_d_date__month == 7 %}{{totalsale.inv_d_sale__sum}}{% endif %}</td>
                        <td>{% if totalsale.inv_d_date__month == 8 %}{{totalsale.inv_d_sale__sum}}{% endif %}</td>
                        <td>{% if totalsale.inv_d_date__month == 9 %}{{totalsale.inv_d_sale__sum}}{% endif %}</td>
                        <td>{% if totalsale.inv_d_date__month == 10 %}{{totalsale.inv_d_sale__sum}}{% endif %}</td>
                        <td>{% if totalsale.inv_d_date__month == 11 %}{{totalsale.inv_d_sale__sum}}{% endif %}</td>
                        <td>{% if totalsale.inv_d_date__month == 12 %}{{totalsale.inv_d_sale__sum}}{% endif %}</td>
                        {% endfor %}

                        <td><B>{{totaldata.inv_d_sale__sum}}</B></td>
                        <td><B>{{totaldata.inv_d_stock__sum}}</B></td>
                        <td><B>{% widthratio totaldata.inv_d_sale__sum 12 1 %}</B></td>
                        <input type="hidden" value="{% widthratio totaldata.inv_d_sale__sum 12 1 as monAvg %}">
                        <td><B>{% widthratio totaldata.inv_d_stock__sum monAvg 1 %}</B></td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="22"><B>No Data</B></td>
                    </tr>
                    {% endif %}
                <tbody>
            </table>
        </div>
    </form>
{% else %}
    <meta http-equiv="refresh" content="0; url='/users/login'" />
{% endif %}
<script type="text/javascript">
    const yearDate = "{{yearDate}}";
    const prdData = "{{prdcode}}";
    // ê¸°ë³¸ ë°ì´í„°
    const data = "{{data}}";
    // ì›”ê°„ íŒë§¤ ë°ì´í„°
    const saleMonData = "{{saleMon}}";
    // ì›”ê°„ íŒë§¤ ë°ì´í„° ì´í•©
    const totalsaleData = "{{totalsale}}";

    const basedata = data.replace(/\&#x27;|\{|\}|\s|\&lt;|\&gt;|\[|\]/g,'').split(/[:,]/);
    // ì›”ê°„ íŒë§¤ ë°ì´í„°
    const saleMon = saleMonData.replace(/\&#x27;|\{|\}|\s|\&lt;|\&gt;|\[|\]/g,'').split(/[:,]/);
    // ì›”ê°„ íŒë§¤ ë°ì´í„° ì´í•©
    const totalsale = totalsaleData.replace(/\&#x27;|\{|\}|\s|\&lt;|\&gt;|\[|\]/g,'').split(/[:,]/);

    // tbody
    let datafield = document.getElementById("datafield");
    // ì›”ê°„ íŒë§¤ ë°ì´í„° í•„ë“œ
    let saleMonField = document.getElementById("saleMonField");
    console.log(data);
    
    let tr = document.createElement('tr');
    if(saleMon.length > 1) {
        let strcode = document.createElement('td');         // é–€å¸‚ä»£è™Ÿ
        let strcity = document.createElement('td');         // ç¸£å¸‚
        let strname = document.createElement('td');         // é–€å¸‚åç¨±
        let strsumsave = document.createElement('td');      // ä¸Šå­˜é‡
        let strsumbuy = document.createElement('td');       // é€²è²¨é‡
        let strsumreturn = document.createElement('td');    // é€€è²¨é‡
        let strsumsale = document.createElement('td');      // éŠ·å”®åŠ ç¸½
        let strsumstock = document.createElement('td');     // åº«å­˜é‡
        let strmonavg = document.createElement('td');       // æœˆå¹³å‡
        let strmonstock = document.createElement('td');     // åº«å­˜æœˆä»½

        // éŠ·è²¨é‡ 1æœˆ ~ 12æœˆ
        for(var i = 0; i < saleMon.length; i++){
            strcode.innerHTML = saleMon[i*6+1];
            strcity.innerHTML = saleMon[i*6+1];
            let td = document.createElement('td'); 
            
            if(saleMon[i*6+3] == 1){
                //document.getElementById("saleMonField1").innerHTML = saleMon[i*6+5];
                td.innerHTML = saleMon[i*6+5];
                tr.append(td);
            } else if (saleMon[i*6+3] == 2) {
                td.innerHTML = saleMon[i*6+5];
                tr.append(td);
                //document.getElementById("saleMonField2").innerHTML = saleMon[i*6+5];
            } else if (saleMon[i*6+3] == 3) {
                td.innerHTML = saleMon[i*6+5];
                tr.append(td);
                //document.getElementById("saleMonField3").innerHTML = saleMon[i*6+5];
            } else if (saleMon[i*6+3] == 4) {
                td.innerHTML = saleMon[i*6+5];
                tr.append(td);
                //document.getElementById("saleMonField4").innerHTML = saleMon[i*6+5];
            } else if (saleMon[i*6+3] == 5) {
                td.innerHTML = saleMon[i*6+5];
                tr.append(td);
                //document.getElementById("saleMonField5").innerHTML = saleMon[i*6+5];
            } else if (saleMon[i*6+3] == 6) {
                td.innerHTML = saleMon[i*6+5];
                tr.append(td);
                //document.getElementById("saleMonField6").innerHTML = saleMon[i*6+5];
            } else if (saleMon[i*6+3] == 7) {
                td.innerHTML = saleMon[i*6+5];
                tr.append(td);
                //document.getElementById("saleMonField7").innerHTML = saleMon[i*6+5];
            } else if (saleMon[i*6+3] == 8) {
                td.innerHTML = saleMon[i*6+5];
                tr.append(td);
                //document.getElementById("saleMonField8").innerHTML = saleMon[i*6+5];
            } else if (saleMon[i*6+3] == 9) {
                td.innerHTML = saleMon[i*6+5];
                tr.append(td);
                //document.getElementById("saleMonField9").innerHTML = saleMon[i*6+5];
            } else if (saleMon[i*6+3] == 10) {
                td.innerHTML = saleMon[i*6+5];
                tr.append(td);
                //document.getElementById("saleMonField10").innerHTML = saleMon[i*6+5];
            } else if (saleMon[i*6+3] == 11) {
                td.innerHTML = saleMon[i*6+5];
                tr.append(td);
                //document.getElementById("saleMonField11").innerHTML = saleMon[i*6+5];
            } else if (saleMon[i*6+3] == 12) {
                td.innerHTML = saleMon[i*6+5];
                tr.append(td);
                //document.getElementById("saleMonField12").innerHTML = saleMon[i*6+5];
            } else {
                td.innerHTML = '-';
                tr.append(td);
            }
            datafield.append(tr);
        }

    }

    console.log();

</script>
<script src="{% static 'script/csy.js' %}"></script>
{% endblock %}