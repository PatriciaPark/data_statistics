{% extends 'base.html' %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<link rel="stylesheet" href="{% static 'css/csr.css' %}">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<style type="text/css"></style>
{% if user.is_authenticated %} 
    <h3 class="menuTitle">Store Review</h3>
    <div class="dataInput">
        <form action="/store/create/" enctype="multipart/form-data" method="POST">{% csrf_token %}
            <table class="tableGrid">
                <tr>
                    <th colspan="3">New Review</th>
                </tr>
                <tr>
                    <td>
                        <select name="add-loc" id="selectAddLoc" class="select">
                            <option value="all" selected>Location</option>
                            {% for loc in loc %}
                            <option value="{{loc.str_loc}}">{{loc.str_loc}}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <select name="add-city" id="selectAddCity" class="select">
                            <option value="all" selected>City</option>
                            {% for city in city %}
                            <option value="{{city.str_city}}">{{city.str_city}}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <select name="add-str" id="selectAddStr" class="select">
                            <option value="all" selected>Store</option>
                            {% for str in str %}
                            <option value="{{str.str_name}}">{{str.str_name}}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <textarea name="add-comm" placeholder="Comments" rows="3" cols="70"></textarea>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <input type="radio" id="one" name="add_rate" value="1">
                        <label for="one">‚òÖ</label>&emsp;
                        <input type="radio" id="two" name="add_rate" value="2">
                        <label for="two">‚òÖ‚òÖ</label>&emsp;
                        <input type="radio" id="thr" name="add_rate" value="3">
                        <label for="thr">‚òÖ‚òÖ‚òÖ</label>&emsp;
                        <input type="radio" id="fou" name="add_rate" value="4">
                        <label for="fou">‚òÖ‚òÖ‚òÖ‚òÖ</label>&emsp;
                        <input type="radio" id="fiv" name="add_rate" value="5">
                        <label for="fiv">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</label>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <input type="file" id="add-img" class="image_inputType_file" accept="img/*" required multiple>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <input type="submit" id="btnWrite" value="ADD">
                    </td>
                </tr>
            </table>
        </form>
    </div>
    <div class="dataGrid">
        <form method="GET" id="selectForm">
            <div>
                <select name="input-loc" id="selectSearchLoc" class="select" onChange="selectedLoc()">
                    <option value="all" selected>Location</option>
                    {% for loc in loc %}
                    <option value="{{loc.str_loc}}">{{loc.str_loc}}</option>
                    {% endfor %}
                </select>
                <select name="input-city" id="selectSearchCity" class="select" onChange="selectedCity()">
                    <option value="all" selected>City</option>
                    {% for city in city %}
                    <option value="{{city.str_city}}">{{city.str_city}}</option>
                    {% endfor %}
                </select>
                <select name="input-str" id="selectSearchStr" class="select" onChange="selectedStr()">
                    <option value="all" selected>Store</option>
                    {% for str in str %}
                    <option value="{{str.str_name}}">{{str.str_name}}</option>
                    {% endfor %}
                </select>
                <input type="submit" id="btnSearch" value="üîçÔ∏é">
                <input type="reset" id="btnReset" value="Reset">
            </div>
            <p id="pCount">Êï∏ÊìöÊï∏ : {{data.count}} Ê¢ù</p>
            <table class="tableGrid" >
                <thead>
                    <tr>
                        <th>Location</th>
                        <th>City</th>
                        <th>Store</th>
                        <th>Image</th>
                        <th>Comment</th>
                        <th>Rate</th>
                        <th>Writer</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% if data %}
                    {% for data in data %}
                    <tr>
                        <td>{{data.str_code__str_loc}}</td>
                        <td>{{data.str_code__str_city}}</td>
                        <td>{{data.str_code__str_name}}</td>
                        <td>{{data.str_img}}</td>
                        <td>{{data.str_comm}}</td>
                        <td>{{data.str_rate}}</td>
                        <td>{{data.user_id}}</td>
                        <td>{{data.str_date}}</td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="8"><B>No Data</B></td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </form>
    </div>
{% else %}
    <meta http-equiv="refresh" content="0; url='/users/login'" />
{% endif %}
<script>
    // jQuery Code
    // select first select box value : change second select box value
    $('#selectAddLoc').on("propertychange change keyup input click", function() {
        // send ajax request when the first select is changed:
        $.ajax({
            url : '/csr/select/',
            type : 'GET',
            data : {
                location : $(this).val()
            },
            dataType: 'json',
            success : function(response) {
                // this function executes on receiving a successful response from the backend:
                var secondSelect = $('#selectAddCity');
                secondSelect.empty();
        
                // iterate over the instances in the response and add them to the second select
                for (var instance in response.data) {
                    secondSelect.append($('<option>', {
                        value : response.data[instance].str_city,
                        text : response.data[instance].str_city
                    }));
                }
            }
        })
    });

    $('#selectAddCity').on("propertychange change keyup input click", function() {
        $.ajax({
            url : '/csr/select2/',
            type : 'GET',
            data : {
                city : $(this).val()
            },
            dataType: 'json',
            success : function(response) {
                // this function executes on receiving a successful response from the backend:
                var secondSelect = $('#selectAddStr');
                secondSelect.empty();
        
                // iterate over the instances in the response and add them to the second select
                for (var instance in response.data) {
                    secondSelect.append($('<option>', {
                        value : response.data[instance].str_name,
                        text : response.data[instance].str_name
                    }));
                }
            }
        })
    });
</script>
<script src="{% static 'script/csr.js' %}"></script>
{% endblock %}